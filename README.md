# KAce - 跨平台自动化应用框架

> 基于 Kotlin Multiplatform 的跨平台CMS管理系统，支持 Android、iOS、Windows、macOS 等多个平台。

## 🛠️ 技术栈

### 核心技术
- **Kotlin Multiplatform**: 跨平台代码共享
- **Compose Multiplatform**: 现代化 UI 框架
- **Ktor**: 网络通信和服务端
- **SQLDelight**: 跨平台数据库
- **Kotlinx.coroutines**: 异步编程
- **Kotlinx.serialization**: 数据序列化

## 📋 产品功能

### 核心功能
- **插件框架**：提供插件的注册、管理和运行环境
- **用户角色系统**：完整的用户管理、角色权限控制系统
- **媒体资源系统**：文件上传、图片处理、媒体管理功能
- **菜单系统**：全局菜单服务，集中管理应用导航结构
- **多语言支持**：界面的多语言管理
- **主题系统**：自定义系统外观和布局
- **API框架**：提供统一的API注册和访问机制

### 扩展功能
- **插件系统**：业务功能通过插件形式实现和扩展
- **内容管理插件**：文章、产品等各类内容管理
- **表单构建插件**：无代码创建数据收集表单
- **SEO优化插件**：提升内容搜索引擎可见性
- **数据分析插件**：内容访问和用户行为分析
- **第三方集成插件**：支付、社交媒体等集成

## 🎨 设计风格

- **设计系统**: Material Design 3 (Material You)
- **主题**: 亮/暗模式，可自定义主色调
- **布局**: 响应式设计，适配不同设备尺寸
- **交互**: 手势友好，动画流畅
- **可访问性**: 符合WCAG 2.1标准
- **国际化**: 支持RTL布局和多语言

## 🏗️ 系统架构

### 服务端架构

#### 技术选型
- **后端语言**: Kotlin
- **框架**: Ktor
- **数据库**: 支持多种数据库(MySQL, MongoDB, PostgreSQL等)，可通过配置文件切换, Redis (缓存)
- **消息队列**: RabbitMQ
- **搜索引擎**: Elasticsearch
- **文件存储**: 支持多种存储方式(本地存储、MinIO、腾讯COS、阿里OSS等)，可通过配置切换
- **身份认证**: OAuth 2.0 + JWT
- **部署**: Docker

#### 架构模式
- 单体架构
- 简化的领域驱动设计
- 事件驱动

#### 主要模块
- 认证模块
- 内容模块
- 用户管理模块
- 媒体模块
- 分析模块
- 通知模块
- API接口

### 客户端架构

#### 共享代码架构
- **网络层**: Ktor客户端
- **数据层**: SQLDelight + Repository模式
- **业务逻辑**: ViewModel + 状态管理
- **依赖注入**: Koin
- **共享UI组件**: Compose Multiplatform

#### 多平台支持
- **Web端**: Compose Multiplatform for Web (Compose HTML)
- **移动端**: Android & iOS 通过 Compose Multiplatform
- **桌面端**: Windows & macOS 通过 Compose Multiplatform for Desktop

### 插件架构

#### 核心架构
- 基于接口的插件系统
- 动态加载和注册机制
- 插件生命周期管理
- 插件间依赖和通信

#### 基础核心模块
```
core/
  ├── plugin-api/     (插件接口定义)
  ├── user-rbac/      (用户角色权限系统)
  ├── media-system/   (媒体资源管理)
  ├── menu-system/    (菜单系统)
  ├── database/       (数据访问)
  ├── ui-core/        (UI基础组件)
  └── api-framework/  (API框架)
```

#### 插件模块示例
```
plugins/
  ├── article-plugin/    (文章管理插件)
  ├── product-plugin/    (产品管理插件)
  ├── gallery-plugin/    (图库管理插件)
  ├── video-plugin/      (视频管理插件)
  ├── event-plugin/      (活动管理插件)
  └── form-plugin/       (表单管理插件)
```

## 📊 模块详细设计

### 插件系统框架

#### 插件生命周期
- 插件发现与加载
- 插件初始化
- 插件启动与停止
- 插件热更新
- 插件版本管理

#### 插件能力
- 独立数据模型：每个插件定义自己的数据结构
- 独立路由注册：每个插件注册自己的API路由
- 独立权限定义：插件可定义自己的权限点
- 独立UI组件：插件可提供自己的界面组件
- 独立菜单项：插件可注册自己的菜单项
- 事件发布订阅：插件间通过事件机制通信

#### 插件管理
- 插件市场：浏览和安装插件
- 插件配置：每个插件的独立配置
- 插件依赖管理：处理插件间的依赖关系
- 插件冲突解决：处理插件间的冲突

#### 插件开发工具
- 插件脚手架：快速创建新插件
- 插件测试框架：便于测试插件功能
- 插件打包工具：将插件打包为可分发格式

### 用户角色权限系统

#### 用户管理
- 用户注册与认证：多种认证方式支持
- 用户资料管理：灵活的用户信息字段
- 用户状态控制：启用/禁用/锁定等
- 用户分组：支持部门、组织等结构

#### 角色管理
- 角色定义：自定义角色及描述
- 角色层级：支持角色继承关系
- 角色分配：用户与角色的关联管理
- 角色模板：常用角色快速创建

#### 权限控制
- 权限点定义：细粒度的权限控制点
- 权限分配：基于角色的权限分配
- 动态权限：支持运行时权限判断
- 权限缓存：高效的权限检查机制
- 多层级权限：支持"资源:操作:范围"三层级权限命名规范
- 界面元素权限：控制按钮、表单字段等UI元素的可见性
- 数据权限：控制用户可访问的数据范围（全部/部门/个人）
- 操作权限：控制用户可执行的操作（读取/创建/编辑/删除）
- 字段权限：控制用户可查看或编辑的具体字段
- API权限：对API接口的细粒度访问控制

#### 安全审计
- 操作日志：记录关键操作
- 登录记录：用户登录历史
- 异常检测：识别可疑行为
- 安全报告：安全状况报告

### 媒体资源系统

#### 文件管理
- 文件上传：多文件上传，大文件分片
- 文件组织：目录结构管理
- 文件访问控制：基于权限的访问限制
- 文件操作：复制、移动、重命名等

#### 图片处理
- 图片裁剪：自动和手动裁剪
- 图片缩放：自动生成多种尺寸
- 图片格式转换：支持多种格式转换
- 图片优化：自动压缩和优化

#### 媒体资源库
- 资源搜索：基于元数据搜索
- 资源分类：标签和分类管理
- 资源预览：内置各类媒体预览
- 使用追踪：媒体资源使用情况

#### 存储策略
- 多存储支持：本地、云存储等
- 存储配置：针对不同类型媒体的策略
- 存储迁移：数据在不同存储间迁移
- 存储监控：容量和使用状况监控

### 菜单系统

#### 菜单结构
- 多级菜单支持：支持无限层级的菜单结构
- 菜单分组：将相关菜单分组展示
- 菜单排序：控制菜单项显示顺序
- 菜单图标：支持各种图标样式

#### 菜单管理
- 菜单配置：通过管理界面配置菜单
- 菜单权限：控制菜单项的访问权限
- 菜单状态：启用/禁用特定菜单项
- 动态菜单：根据用户权限动态生成菜单

#### 菜单扩展
- 插件菜单注册：插件可注册自己的菜单项
- 菜单钩子：允许修改现有菜单结构
- 自定义渲染：支持自定义菜单渲染方式
- 上下文菜单：支持不同场景的上下文菜单

### 基础插件示例

#### 用户角色权限插件
- 用户管理：用户注册、认证和管理
- 角色管理：自定义角色创建与配置
- 权限点管理：细粒度权限控制
- 权限分配：角色权限和用户权限分配
- 权限检查API：供其他插件调用的权限验证接口

#### 文章管理插件
- 文章编辑：支持富文本和Markdown
- 文章分类：分类体系管理
- 文章标签：灵活的标签系统
- 评论管理：文章评论功能
- 文章工作流：草稿、审核、发布流程

#### 媒体资源插件
- 媒体库：集中管理图片、视频、文档
- 图片处理：自动生成不同尺寸的图片
- 媒体分类：资源分类管理
- 权限控制：媒体资源访问权限